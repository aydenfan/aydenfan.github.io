<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="3YCLbA3SHzUUWt-KV1meP63d_oZXk4aWs39RGMF9yr4">
  <meta name="baidu-site-verification" content="code-Ow3hv85wwO">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aydenfan.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="摘要Our work focuses on tackling the challenging but natural visual recognition task of long-tailed data distribution (i.e., a few classes occupy most of the data, while most classes have rarely few sam">
<meta property="og:type" content="article">
<meta property="og:title" content="BBN Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognition">
<meta property="og:url" content="https://aydenfan.github.io/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html">
<meta property="og:site_name" content="Ayden">
<meta property="og:description" content="摘要Our work focuses on tackling the challenging but natural visual recognition task of long-tailed data distribution (i.e., a few classes occupy most of the data, while most classes have rarely few sam">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210413093139992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210413094008781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210413101330302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210413101443375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2021-06-23T07:40:29.000Z">
<meta property="article:modified_time" content="2021-06-30T12:25:30.655Z">
<meta property="article:author" content="Ayden Fan">
<meta property="article:tag" content="不均衡">
<meta property="article:tag" content="分类">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210413093139992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="https://aydenfan.github.io/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>BBN Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognition | Ayden</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<a target="_blank" rel="noopener" href="https://github.com/aydenfan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ayden</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-top">

    <a href="/top/" rel="section"><i class="fa fa-signal fa-fw"></i>阅读排行</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aydenfan.github.io/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ayden Fan">
      <meta itemprop="description" content="AI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayden">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BBN Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognition
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-23 15:40:29" itemprop="dateCreated datePublished" datetime="2021-06-23T15:40:29+08:00">2021-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-30 20:25:30" itemprop="dateModified" datetime="2021-06-30T20:25:30+08:00">2021-06-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" itemprop="url" rel="index"><span itemprop="name">论文阅读</span></a>
                </span>
            </span>

          
            <span id="/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html" class="post-meta-item leancloud_visitors" data-flag-title="BBN Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognition" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>Our work focuses on tackling the challenging but natural visual recognition task of long-tailed data distribution (i.e., a few classes occupy most of the data, while most classes have rarely few samples). In the literature, class re-balancing strategies (e.g., re-weighting and re-sampling) are the prominent and effective methods proposed to alleviate the extreme imbalance for dealing with long-tailed problems. In this paper , we firstly discover that these rebalancing methods achieving satisfactory recognition accuracy owe to that they could significantly promote the classifier learning of deep networks. However, at the same time, they will unexpectedly damage the representative ability of the learned deep features to some extent. Therefore, we propose a unified Bilateral-Branch Network (BBN) to take care of both representation learning and classifier learning simultaneously, where each branch does perform its own duty separately. In particular , our BBN model is further equipped with a novel cumulative learning strategy, which is designed to first learn the universal patterns and then pay attention to the tail data gradually. Extensive experiments on four benchmark datasets, including the large-scale iNaturalist ones, justify that the proposed BBN can significantly outperform state-of-the-art methods. Furthermore, validation experiments can demonstrate both our preliminary discovery and effectiveness of tailored designs in BBN for long-tailed problems. Our method won the first place in the iNaturalist 2019 large scale species classification competition, and our code is open-source and available at <a target="_blank" rel="noopener" href="https://github.com/Megvii-Nanjing/BBN">https://github.com/Megvii-Nanjing/BBN</a>.<span id="more"></span></p>
<p>我们的工作重点是解决长尾数据分布的具有挑战性但自然的视觉识别任务（即少数类占据了大部分数据，而大多数类很少有样本）。在文献中，类重平衡策略（如重加权和重采样）是解决长尾问题的突出而有效的方法。在本文中，我们首先发现，这些再平衡方法之所以能达到令人满意的识别精度，是因为它们能显著地促进深层网络的分类器学习。但同时，也会在一定程度上意外地损害所学深层特征的表征能力。因此，我们提出了一个统一的双边分支网络（BBN），同时兼顾表示学习和分类器学习，每个分支单独执行各自的任务。特别地，我们的BBN模型进一步配备了一种新的累积学习策略，即先学习通用模式，然后逐渐关注尾部数据。在四个基准数据集（包括大规模的不自然数据集）上进行的大量实验表明，所提出的BBN方法的性能明显优于现有的方法。此外，验证实验可以证明我们在BBN中针对长尾问题的定制设计的初步发现和有效性。我们的方法在2019年大型物种分类比赛中获得了第一名，我们的代码是开源的，<a target="_blank" rel="noopener" href="https://github.com/Megvii-Nanjing/BBN。">https://github.com/Megvii-Nanjing/BBN。</a></p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>尽管re-weighting方法具有很好的预测效果，但这些方法仍然存在不利影响，即它们也会在一定程度上会损害所学习的深层特征（即表征学习）的表征能力。具体来说，当数据极度不平衡时，重采样有过拟合尾部数据（通过过采样）的风险，也有无法拟合整个数据分布（通过欠采样）的风险。对于重加权，它会通过直接改变甚至反转数据呈现频率来扭曲原始分布。<br><img src="https://img-blog.csdnimg.cn/20210413093139992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70" alt="Top-1 error rates of different manners for representation learning and classifier learning on two long-tailed datasets CIFAR-100-
IR50 and CIFAR-10-IR50"><br>上图表明了平衡策略对特征学习和分类学习的影响。作者采用了简单训练（传统的交叉熵）、重加权和重采样三种学习方式来获得它们相应的学习表示。然后，在分类器学习的后一阶段，首先确定前一阶段收敛的表示学习参数（即冻结主干层），然后对这些网络的分类器（即全连通层）采用前面所述的三种方式进行从头训练。<br>最终证明：<strong>平衡策略会损害表征学习，促进分类学习</strong></p>
<h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><p><img src="https://img-blog.csdnimg.cn/20210413094008781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70" alt="Framework of our Bilateral-Branch Network (BBN)"><br>——————————————————————————————————————————————————<br><em>为了彻底提高长尾问题的识别性能，本文提出了一种同时兼顾表示学习和分类器学习的统一双边分支网络（BBN）模型。如上图所示，我们的BBN模型由两个分支组成，称为“传统学习分支”和“重新平衡分支”。BBN的每个分支分别对表示学习和分类器学习履行各自的职责。顾名思义，配备了典型的统一采样器w.r.t.的传统的学习分支学习原始数据分布来对通用模式进行识别。同时，设计了再平衡支路和反向采样器对尾数据进行建模。然后，通过自适应折衷参数α将这些双边分支的预测输出聚合到累积学习部分。α是由“适配器”根据训练epochs的个数自动生成的，它调整整个BBN模型，首先从原始分布中学习全局特征，然后逐步关注尾部数据。更重要的是，α可以进一步控制每个分支的参数更新，例如，在训练后期强调尾部数据时，避免了对所学习的通用特征的破坏。</em></p>
<h2 id="总体框架"><a href="#总体框架" class="headerlink" title="总体框架"></a>总体框架</h2><p>具体来说：两个分支分别用于表示学习和分类器学习，分别称为“传统学习分支(Conventional Learning Branch)”和“再平衡分支”(Re-balancing Branch)。两个分支使用相同的残差网络结构并且共享除最后一个残差块之外的所有权重。设$x .$表示训练样本，$y . \in\{1,2, \ldots, C\}$是它对应的标签，其中$C$是类的数目。对于双边分支，我们分别对每个分支应用均匀和反向采样，并获得两个样本$\left(\mathbf{x}_{c}, y_{c}\right)$和$\left(\mathbf{x}_{r}, y_{r}\right)$作为输入数据，其中$\left(\mathbf{x}_{c}, y_{c}\right)$表示常规学习分支，$\left(\mathbf{x}_{r}, y_{r}\right)$表示重新平衡分支。然后，将两个样本送入各自对应的分支，通过全局平均池化得到特征向量$fc$和$fr$，将两个向量送进累计学习分支，通过随训练迭代次数自调节的$\alpha$来合成新的特征向量，对此向量进行分类学习，合成公式如下：</p>
<script type="math/tex; mode=display">\mathbf{z}=\alpha \boldsymbol{W}_{c}^{\top} \boldsymbol{f}_{c}+(1-\alpha) \boldsymbol{W}_{r}^{\top} \boldsymbol{f}_{r}</script><h2 id="采样策略"><a href="#采样策略" class="headerlink" title="采样策略"></a>采样策略</h2><p>Conventional Learning Branch在一个训练epoch中，训练数据集中的每个样本以相同的概率采样一次。均匀采样器保留了原始分布的特征，有利于表征学习。然而，Re-balancing Branch的目的在于缓解极端的不平衡，特别是提高尾类（tail类）的分类精度，尾类的输入数据来自于反向采样器。对于反向取样器，每个类的采样可能性与其样本大小的倒数成正比，即类中的样本越多，类具有的采样可能性越小。</p>
<h2 id="共享权重"><a href="#共享权重" class="headerlink" title="共享权重"></a>共享权重</h2><p>BBN中，两个分支共享相同的残差网络结构。网络除了最后一个残差块，共享相同的权重。共享权重有两个好处：</p>
<ol>
<li>Conventional Learning Branch的良好学习表示有利于重平衡分支的学习；</li>
<li>在推理阶段，共享权重将大大降低计算复杂度。</li>
</ol>
<h2 id="累计学习"><a href="#累计学习" class="headerlink" title="累计学习"></a>累计学习</h2><p>通过控制两个分支产生的特征的权重和分类损失$L$，$\mathcal{L}=\alpha E\left(\hat{\boldsymbol{p}}, y_{c}\right)+(1-\alpha) E\left(\hat{\boldsymbol{p}}, y_{r}\right)$，在两个分支之间转移学习重心。首先学习通用模式，然后逐步关注尾部数据。$\mathbf{z}=\alpha \boldsymbol{W}_{c}^{\top} \boldsymbol{f}_{c}+(1-\alpha) \boldsymbol{W}_{r}^{\top} \boldsymbol{f}_{r}$。$\alpha$的计算公式为:</p>
<script type="math/tex; mode=display">\alpha=1-\left(\frac{T}{T_{\max }}\right)^{2}</script><h2 id="推理阶段"><a href="#推理阶段" class="headerlink" title="推理阶段"></a>推理阶段</h2><p>将$\alpha$设为0.5，因为两个分支同等重要</p>
<h1 id="消融实验"><a href="#消融实验" class="headerlink" title="消融实验"></a>消融实验</h1><p>Re-balancing Branch中使用不同的采样器，反向采样器效果最好<br><img src="https://img-blog.csdnimg.cn/20210413101330302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70" alt=""><br>累计学习中$\alpha$的不同降低策略，抛物线最好<br><img src="https://img-blog.csdnimg.cn/20210413101443375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTE4OTY4,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="代码实现（自己参照源码写的粗糙的网络）"><a href="#代码实现（自己参照源码写的粗糙的网络）" class="headerlink" title="代码实现（自己参照源码写的粗糙的网络）"></a>代码实现（自己参照源码写的粗糙的网络）</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">class Combiner(nn.Module):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        super(Combiner, self).__init__()</span><br><span class="line">        self.epoch_number = 80</span><br><span class="line">        self.func = torch.nn.Softmax(dim=1)</span><br><span class="line">        self.initilize_all_parameters()</span><br><span class="line">        self.resnet = resnet50(pretrained=True)</span><br><span class="line">        self.backbone = torch.nn.Sequential(*list(self.resnet.children())[:-2])</span><br><span class="line">        self.module = nn.AdaptiveAvgPool2d((1, 1))</span><br><span class="line">        self.gender = DenseLayer(1, 32)</span><br><span class="line">        self.classifier = nn.Linear(2*(2048+32), 240)</span><br><span class="line">        self.softmax = nn.Softmax(dim=1)</span><br><span class="line">        self.block = Bottleneck</span><br><span class="line">        self.cb_block = self.block(2048, 2048 // 4, stride=1)</span><br><span class="line">        self.rb_block = self.block(2048, 2048 // 4, stride=1)</span><br><span class="line"></span><br><span class="line">    def initilize_all_parameters(self):</span><br><span class="line">        self.alpha = 0.2</span><br><span class="line">        <span class="keyword">if</span> self.epoch_number <span class="keyword">in</span> [90, 180]:</span><br><span class="line">            self.div_epoch = 100 * (self.epoch_number // 100 + 1)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.div_epoch = self.epoch_number</span><br><span class="line"></span><br><span class="line">    def forward(self, <span class="built_in">source</span>, meta, epoch):</span><br><span class="line"></span><br><span class="line">        image_a, image_b = <span class="built_in">source</span>[<span class="string">&quot;image&quot;</span>], meta[<span class="string">&quot;sample_image&quot;</span>]</span><br><span class="line"></span><br><span class="line">        feature_a, feature_b = (</span><br><span class="line">            (self.module(self.cb_block(self.backbone(image_a)))).view(image_a.shape[0], -1),</span><br><span class="line">            (self.module(self.rb_block(self.backbone(image_b)))).view(image_a.shape[0], -1),</span><br><span class="line">        )</span><br><span class="line">        l = 1 - (epoch / self.div_epoch) ** 2  <span class="comment"># parabolic decay</span></span><br><span class="line">        <span class="comment"># l = 0.5  # fix</span></span><br><span class="line">        <span class="comment"># l = math.cos((self.epoch-1) / self.div_epoch * math.pi /2)   # cosine decay</span></span><br><span class="line">        <span class="comment"># l = 1 - (1 - ((self.epoch - 1) / self.div_epoch) ** 2) * 1  # parabolic increment</span></span><br><span class="line">        <span class="comment"># l = 1 - (self.epoch-1) / self.div_epoch  # linear decay</span></span><br><span class="line">        <span class="comment"># l = np.random.beta(self.alpha, self.alpha) # beta distribution</span></span><br><span class="line">        <span class="comment"># l = 1 if self.epoch &lt;= 120 else 0  # seperated stage</span></span><br><span class="line">        mixed_feature = 2 * torch.cat((l * feature_a, (1 - l) * feature_b), dim=1)</span><br><span class="line">        output = self.classifier(mixed_feature)</span><br><span class="line">        output = self.softmax(output)</span><br><span class="line">        <span class="built_in">return</span> output, l</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Ayden Fan 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Ayden Fan 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E4%B8%8D%E5%9D%87%E8%A1%A1/" rel="tag"># 不均衡</a>
              <a href="/tags/%E5%88%86%E7%B1%BB/" rel="tag"># 分类</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Cross-X%20Learning%20for%20Fine-Grained%20Visual%20Categorization.html" rel="prev" title="Cross-X Learning for Fine-Grained Visual Categorization">
      <i class="fa fa-chevron-left"></i> Cross-X Learning for Fine-Grained Visual Categorization
    </a></div>
      <div class="post-nav-item">
    <a href="/Welcome.html" rel="next" title="Welcome">
      Welcome <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">具体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="nav-number">3.1.</span> <span class="nav-text">总体框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%87%E6%A0%B7%E7%AD%96%E7%95%A5"><span class="nav-number">3.2.</span> <span class="nav-text">采样策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B1%E4%BA%AB%E6%9D%83%E9%87%8D"><span class="nav-number">3.3.</span> <span class="nav-text">共享权重</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%AF%E8%AE%A1%E5%AD%A6%E4%B9%A0"><span class="nav-number">3.4.</span> <span class="nav-text">累计学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E7%90%86%E9%98%B6%E6%AE%B5"><span class="nav-number">3.5.</span> <span class="nav-text">推理阶段</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B6%88%E8%9E%8D%E5%AE%9E%E9%AA%8C"><span class="nav-number">4.</span> <span class="nav-text">消融实验</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%EF%BC%88%E8%87%AA%E5%B7%B1%E5%8F%82%E7%85%A7%E6%BA%90%E7%A0%81%E5%86%99%E7%9A%84%E7%B2%97%E7%B3%99%E7%9A%84%E7%BD%91%E7%BB%9C%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">代码实现（自己参照源码写的粗糙的网络）</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ayden Fan"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Ayden Fan</p>
  <div class="site-description" itemprop="description">AI</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/aydenfan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;aydenfan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_41118968" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_41118968" rel="noopener" target="_blank"><i class="fab fa-csdn fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/fan-wei-27-47" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;fan-wei-27-47" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://aydenfan.github.io/" title="https:&#x2F;&#x2F;aydenfan.github.io">My Github</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ayden Fan</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://aydenfan.github.io/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'fkFwxJ54gTWQX7xiHyNQioaM-gzGzoHsz',
      appKey     : 'pGzfTN4rExMFsf8WCoe2lpdg',
      placeholder: "来都来了，不撩一句嘛~，留言记得在上面留下【邮箱】，方便收到回复通知~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://aydenfan.github.io/BBN%20Bilateral-Branch%20Network%20with%20Cumulative%20Learning%20for%20Long-Tailed%20Visual%20Recognition.html',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'fkFwxJ54gTWQX7xiHyNQioaM-gzGzoHsz',
      appKey     : 'pGzfTN4rExMFsf8WCoe2lpdg',
      placeholder: "来都来了，不撩一句嘛~，留言记得在上面留下【邮箱】，方便收到回复通知~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>







<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":180,"height":160},"mobile":{"show":true}});</script></body>
</html>
